<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="MATLAB R2018a"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><title>Map Estimation</title><style type="text/css">
* {margin: 0; padding: 0;}
body {text-align: start; line-height: 17.2339992523193px; min-height: 0px; white-space: normal; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-style: normal; font-size: 14px; font-weight: normal; text-decoration: none; white-space: normal; }
h1, h2 {font-weight: normal;}
.content { padding: 30px; }

.S0 { margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S1 { text-align: left; line-height: 26.3999996185303px; min-height: 24px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-size: 22px; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 15px; margin-right: 10px;  }
.S2 { min-height: 0px; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S3 { text-align: left; line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 15px; margin-bottom: 9px; margin-right: 10px;  }
.S4 { margin-left: 3px; margin-top: 10px; margin-bottom: 4px; margin-right: 3px;  }
.S5 { min-height: 18px; white-space: nowrap; white-space: nowrap; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S6 { min-height: 0px; white-space: pre; white-space: pre; margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S7 { color: rgb(160, 32, 240); margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S8 { text-align: left; line-height: 20.576000213623px; min-height: 20px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; white-space: pre-wrap; margin-left: 4px; margin-top: 3px; margin-bottom: 9px; margin-right: 10px;  }
.S9 { text-align: left; line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 2px; margin-bottom: 9px; margin-right: 10px;  }
.S10 { color: rgb(0, 0, 255); margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S11 { color: rgb(34, 139, 34); margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }
.S12 { margin-left: 3px; margin-top: 10px; margin-bottom: 10px; margin-right: 3px;  }
.S13 { text-align: left; line-height: 21px; min-height: 17px; white-space: pre-wrap; font-family: Helvetica, Arial, sans-serif; white-space: pre-wrap; margin-left: 4px; margin-top: 10px; margin-bottom: 9px; margin-right: 10px;  }
.S14 { color: rgb(64, 64, 64); margin-left: 0px; margin-top: 0px; margin-bottom: 0px; margin-right: 0px;  }

.CodeBlock {margin: 10px 0 10px 0; background-color: #F7F7F7;}
.CodeBlock+.paragraphNode {margin-top: 10px;}
.lineNode {padding-left: 10px; border-left: 1px solid #E9E9E9; border-right: 1px solid #E9E9E9;}
.inlineWrapper:first-child .lineNode,.inlineWrapper.outputs+.inlineWrapper .lineNode {padding-top: 5px; border-top: 1px solid #E9E9E9;}
.inlineWrapper:last-child .lineNode,.inlineWrapper.outputs .lineNode {padding-bottom: 5px; border-bottom: 1px solid #E9E9E9;}
.lineNode .textBox {white-space: pre;}
.outputGroup {margin: 2px 0 2px 0; padding: 2px 2px 2px 4px;}
.outputRegion {}
.outputParagraph {color: rgba(64, 64, 64, 1); padding: 10px 0 6px 17px; background: white; overflow-x: hidden;}
.inlineWrapper:last-child .outputParagraph {border-bottom-left-radius: 4px; border-bottom-right-radius: 4px;}
.outputParagraph:empty {margin: 0;}
.inlineElement .symbolicElement {margin-top: 1px; margin-bottom: 1px;}
.embeddedOutputsSymbolicElement .MathEquation {margin-top: 4px; margin-bottom: 4px;}
.embeddedOutputsSymbolicElement .MathEquation.displaySymbolicElement {margin-left: 15px;}
.embeddedOutputsSymbolicElement .MathEquation.inlineSymbolicElement {}
.embeddedOutputsSymbolicElement {overflow-x: auto; overflow-y: auto;}
.embeddedOutputsSymbolicElement { overflow: initial !important;}
.embeddedOutputsSymbolicElement { width: 100% !important; }
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {white-space: pre; word-wrap: initial; min-height: 18px; max-height: 250px; overflow: auto;}
.textElement,.rtcDataTipElement .textElement {padding-top: 3px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement { max-height: none !important; overflow: initial !important;}
.veSpecifier {}
.veContainer {}
.veSpecifierBox {height: 400px; width: 500px;}
.veSpecifier .veTable {padding-top: 3px; padding-bottom: 4px;}
.veSpecifierBox .veSpecifier .veContainer {position: relative; width: 100%; height: 370px;}
.veSpecifierBox .dijitDialogPaneContent {width: 97% !important; height: 88% !important;}
.veSpecifier .veTable .rowHeadersWrapper {padding-bottom: 0;}
.veSpecifier .veTable .scroller .variableEditorRenderers {padding-right: 3px; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;}
.veSpecifier .veTable .topHeaderWrapper,.veSpecifier .veTable .bottomRowHeaderWrapper {visibility: hidden; z-index: 0;}
.veMetaSummary {font-style: italic;}
.veSpecifier .veTable .scroller {overflow: hidden;}
.veSpecifier .veTable:hover .scroller {overflow: auto;}
.veSpecifier .veVariableName,.veSpecifier .veDimensionFont {font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;}
.veSpecifier .veVariableName {padding-top: 2px;}
.veSpecifier .veDimensionFont {font-style: italic; color: #9A9A9A;}
.veSpecifier .scroller::-webkit-scrollbar-track {background-color: white;}
.veSpecifier .scroller::-webkit-scrollbar-corner {background-color: white;}
.veSpecifier .veTable .topRowHeaderWrapper {border: none; background-color: #F8F9FA;}
.veSpecifier .mw_type_ListBase.showCellBorders,.veSpecifier .veTable .topHeaderWrapper,.veSpecifier .veTable .bottomRowHeaderWrapper,.veSpecifier .veTable .verticalScrollSpacer,.veSpecifier .veTable .horizontalScrollSpacer {border: none;}
.veSpecifier .veTable .dataScrollerNode {border: 1px solid #BFBFBF;}
.veSpecifier .veTable .columnHeaderNode,.veSpecifier .veTable .rowHeaderNode,.veSpecifier .veTable .dataBody {font-family: Arial; font-size: 13px;}
.veSpecifier .veTable .columnHeaderNode,.veSpecifier .veTable .rowHeaderNode {color: #7F7F7F;}
.veSpecifier .veTable .dataBody {color: #000000;}
.veSpecifier .veTable .columnHeaderNode .cell .drag,.veSpecifier .veTable .columnHeaderNode .cell .header,.veSpecifier .veTable .topHeaderWrapper,.veSpecifier .veTable .bottomRowHeaderWrapper {background-color: #F8F9FA;}
.veSpecifier .veTable .columnHeaderNode .cell .dragBorder {border-right: 1px solid #F8F9FA;}
.veSpecifier .veTable .rowHeaderNode .cell {padding-top: 3px; text-align: center; border-bottom: 1px solid #F8F9FA;}
.veSpecifier .veTable .dataBody .cell .plainText {text-align: right;}
.veSpecifier .veTable .dataBody .row .cell {border-bottom: 1px solid #E9E9E9; border-right: 1px solid #E9E9E9;}
.embeddedOutputsVariableElement {white-space: pre-wrap; word-wrap: break-word; min-height: 18px; max-height: 250px; overflow: auto;}
.variableElement {}
.embeddedOutputsVariableElement.inlineElement {}
.inlineElement .variableElement {}
.variableNameElement {margin-bottom: 3px; display: inline-block;}
.variableValue { width: 100% !important; }
.embeddedOutputsMatrixElement,.eoOutputWrapper .matrixElement {min-height: 18px; box-sizing: border-box;}
.embeddedOutputsMatrixElement .matrixElement,.eoOutputWrapper .matrixElement,.rtcDataTipElement .matrixElement {position: relative;}
.matrixElement .variableValue,.rtcDataTipElement .matrixElement .variableValue {white-space: pre; display: inline-block; vertical-align: top; overflow: hidden;}
.embeddedOutputsMatrixElement.inlineElement {}
.embeddedOutputsMatrixElement.inlineElement .topHeaderWrapper {display: none;}
.embeddedOutputsMatrixElement.inlineElement .veTable .body {padding-top: 0 !important; max-height: 100px;}
.inlineElement .matrixElement {max-height: 300px;}
.embeddedOutputsMatrixElement .matrixElement .valueContainer,.eoOutputWrapper .matrixElement .valueContainer,.rtcDataTipElement .matrixElement .valueContainer {white-space: nowrap; margin-bottom: 3px;}
.embeddedOutputsMatrixElement .matrixElement .valueContainer .horizontalEllipsis.hide,.embeddedOutputsMatrixElement .matrixElement .verticalEllipsis.hide,.eoOutputWrapper .matrixElement .valueContainer .horizontalEllipsis.hide,.eoOutputWrapper .matrixElement .verticalEllipsis.hide,.rtcDataTipElement .matrixElement .valueContainer .horizontalEllipsis.hide,.rtcDataTipElement .matrixElement .verticalEllipsis.hide {display: none;}
.embeddedOutputsVariableMatrixElement .matrixElement .valueContainer.hideEllipses .verticalEllipsis, .embeddedOutputsVariableMatrixElement .matrixElement .valueContainer.hideEllipses .horizontalEllipsis {display:none;}
.embeddedOutputsMatrixElement .matrixElement .valueContainer .horizontalEllipsis,.eoOutputWrapper .matrixElement .valueContainer .horizontalEllipsis {margin-bottom: -3px;}
.eoOutputWrapper .embeddedOutputsVariableMatrixElement .matrixElement .valueContainer {cursor: default !important;}
.matrixElement { max-height: none !important; }
.embeddedOutputsVariableTableElement .ClientViewDiv table tr {height: 22px; white-space: nowrap;}
.embeddedOutputsVariableTableElement .ClientViewDiv table tr td,.embeddedOutputsVariableTableElement .ClientViewDiv table tr th {min-width : 75px; max-width : 75px; background-color:white; text-overflow: ellipsis; font-family: 'Arial', sans-serif; font-size: 12px; overflow : hidden;}
.embeddedOutputsVariableTableElement .ClientViewDiv table tbody tr th {width: 34px; max-width: 100px;}
.embeddedOutputsVariableTableElement .ClientViewDiv table tr span {text-overflow: ellipsis; padding: 3px;}
.embeddedOutputsVariableTableElement .ClientViewDiv table tr th {color: rgba(0,0,0,0.5); padding: 3px; font-size: 9px;}
.embeddedOutputsVariableTableElement .ClientViewDiv table tr th:first-child {min-width: 28px; max-width: 250px;}
.dijitTooltipDialog .dijitTooltipContainer .dijitTooltipContents .alertPlugin-alertMessage {min-width: 12px; max-width: 400px; max-height: 300px; overflow: auto;}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar {width: 11px; height: 11px;}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-track {background-color: rgba(0, 0, 0, 0);}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-corner {background-color: rgba(0, 0, 0, 0);}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-thumb {border-radius: 7px; background-color: rgba(0, 0, 0, 0.1); border: 2px solid rgba(0, 0, 0, 0); background-clip: padding-box;}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-thumb:hover {background-color: rgba(0, 0, 0, 0.2);}
.dijitTooltipDialog .alertPlugin-alertMessage::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, 0);}
.dijitTooltipDialog .alertPlugin-alertMessage:hover::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, 0.1);}
.dijitTooltipDialog .alertPlugin-alertMessage:hover::-webkit-scrollbar-thumb:hover {background-color: rgba(0, 0, 0, 0.2);}
.alertPlugin-alertLine {position: absolute; display: initial; width: 40px; text-align: right; cursor: text;}
.alertPlugin-onTextLine {visibility: hidden;}
.alertPlugin-hasTooltip .alertPlugin-warningImg,.alertPlugin-hasTooltip .alertPlugin-errorImg {cursor: pointer;}
.alertPlugin-alertLine .alertPlugin-warningElement,.alertPlugin-alertLine .alertPlugin-errorElement {display: inline-block; margin-right: 4px;}
.alertPlugin-isStale {-webkit-filter: opacity(0.4) grayscale(80%); filter: opacity(0.4) grayscale(80%);}
.diagnosticMessage-wrapper {font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {color: rgb(255,100,0);}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {color: rgb(255,100,0); text-decoration: underline;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {color: rgb(230,0,0);}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {color: rgb(230,0,0); text-decoration: underline;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart {white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {white-space: pre;}
.embeddedOutputsWarningElement{min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsErrorElement {min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.variableNameElement .headerElement {color: rgb(179, 179, 179); font-style: italic;}
.variableNameElement .headerElement .headerDataType {color: rgb(147, 176, 230);}
.matrixElement .horizontalEllipsis,.rtcDataTipElement .matrixElement .horizontalEllipsis {display: inline-block; margin-top: 3px; width: 30px; height: 12px; background-repeat: no-repeat; background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAJCAYAAADO1CeCAAAAJUlEQVR42mP4//8/A70xw0i29BUDFPxnAEtTW37wWDqakIa4pQDvOOG89lHX2gAAAABJRU5ErkJggg==");}
.matrixElement .verticalEllipsis,.textElement .verticalEllipsis,.rtcDataTipElement .matrixElement .verticalEllipsis,.rtcDataTipElement .textElement .verticalEllipsis {margin-left: 35px; width: 12px; height: 30px; background-repeat: no-repeat; background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAZCAYAAAAIcL+IAAAALklEQVR42mP4//8/AzGYgWyFMECMwv8QddRS+P//KyimlmcGUOFoOI6GI/UVAgDnd8Dd4+NCwgAAAABJRU5ErkJggg==");}
</style></head><body><div class = "content"><div class = 'SectionBlock containment active'><h1 class = "S1"><span class = "S2"><span class="S0">Map Estimation</span></span></h1><h2 class = "S3"><span class = "S2"><span class="S0">1. Load data</span></span></h2><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">clear </span><span class="S7">all</span><span class="S0">; warning </span><span class="S7">off</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">load(</span><span class="S7">'./data/Density_inference.mat'</span><span class="S0">,</span><span class="S7">'data'</span><span class="S0">);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">load(</span><span class="S7">'./data/Density_estimationMap'</span><span class="S0">,</span><span class="S7">'g'</span><span class="S0">);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">load(</span><span class="S7">'./data/Wind_inference.mat'</span><span class="S0">);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">addpath(</span><span class="S7">'./functions/'</span><span class="S0">); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">load </span><span class="S7">coastlines.mat</span></span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2"><span class="S0">4. Multi-night scale</span></span></h2><div class = "S9"><span class = "S2"><span class="S0">Covariance matrix of weather radars</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwmulti.Mu_est = nan(g.nlm,g.nat);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwmulti.Mu_sig = nan(g.nlm,g.nat);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwmulti.Mv_est = nan(g.nlm,g.nat);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwmulti.Mv_sig = nan(g.nlm,g.nat);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0"></span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S10">for </span><span class="S0">i_b=1:numel(data.block.date)</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    id = ~wmulti.isnan &amp; wmulti.B==i_b;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Dtime=squareform(pdist(wmulti.T(id)));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Ddist_aa=squareform(pdist([data.lat(wmulti.R(id)) data.lon(wmulti.R(id))],@lldistkm));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Ddist_ab = pdist2([data.lat data.lon], [g.lat2D(g.latlonmask) g.lon2D(g.latlonmask)], @lldistkm);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Ddist_sf = Ddist_ab(wmulti.R(id), repmat((1:g.nlm)',sum(g.day_b==i_b),1));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Dtime_sf = pdist2(wmulti.T(id), repelem(datenum(g.day(g.day_b==i_b)),g.nlm,1));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span><span class="S11">% u</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Caa = wmulti.cov.C_u(Ddist_aa,Dtime,i_b);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Cab = wmulti.cov.C_u(Ddist_sf,Dtime_sf,i_b);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Lambda = </span><span class="S0">inv</span><span class="S0">(Caa)*Cab;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    gwmulti.Mu_est(:,g.day_b==i_b) = reshape((Lambda' * wmulti.Mus(id)) + wmulti.f_trend(repelem(datenum(g.day(g.day_b==i_b)),g.nlm,1), repmat(g.lat2D(g.latlonmask),sum(g.day_b==i_b),1), repmat(g.lon2D(g.latlonmask),sum(g.day_b==i_b),1), wmulti.beta_u(:,i_b)), g.nlm, sum(g.day_b==i_b));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    gwmulti.Mu_sig(:,g.day_b==i_b) = reshape( sqrt(sum(wmulti.cov.parm_u(1:2,i_b)) - sum(Lambda.*Cab)), g.nlm, sum(g.day_b==i_b));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span><span class="S11">% v</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Caa = wmulti.cov.C_v(Ddist_aa,Dtime,i_b);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Cab = wmulti.cov.C_v(Ddist_sf,Dtime_sf,i_b);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Lambda = </span><span class="S0">inv</span><span class="S0">(Caa)*Cab;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    gwmulti.Mv_est(:,g.day_b==i_b) = reshape((Lambda' * wmulti.Mvs(id)) + wmulti.f_trend(repelem(datenum(g.day(g.day_b==i_b)),g.nlm,1), repmat(g.lat2D(g.latlonmask),sum(g.day_b==i_b),1), repmat(g.lon2D(g.latlonmask),sum(g.day_b==i_b),1), wmulti.beta_v(:,i_b)), g.nlm, sum(g.day_b==i_b));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    gwmulti.Mv_sig(:,g.day_b==i_b) = reshape( sqrt(sum(wmulti.cov.parm_v(1:2,i_b)) - sum(Lambda.*Cab)), g.nlm, sum(g.day_b==i_b));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">        </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S10">end</span></span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><div class = "S9"><span class = "S2"><span class="S0">Figure</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">tmp=nan(g.nlat, g.nlon);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">figure(</span><span class="S7">'position'</span><span class="S0">,[0 0 1000 600]); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">i=1;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S10">for </span><span class="S0">i_t = 1:12:g.nat</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    subplot(4,6,i); hold </span><span class="S7">on</span><span class="S0">; i=i+1;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    h=worldmap([min([g.lat]) max([g.lat])], [min([g.lon]) max([g.lon])]); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    setm(h,</span><span class="S7">'frame'</span><span class="S0">,</span><span class="S7">'on'</span><span class="S0">,</span><span class="S7">'grid'</span><span class="S0">,</span><span class="S7">'off'</span><span class="S0">); set(findall(h,</span><span class="S7">'Tag'</span><span class="S0">,</span><span class="S7">'MLabel'</span><span class="S0">),</span><span class="S7">'visible'</span><span class="S0">,</span><span class="S7">'off'</span><span class="S0">); set(findall(h,</span><span class="S7">'Tag'</span><span class="S0">,</span><span class="S7">'PLabel'</span><span class="S0">),</span><span class="S7">'visible'</span><span class="S0">,</span><span class="S7">'off'</span><span class="S0">)</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    geoshow(</span><span class="S7">'landareas.shp'</span><span class="S0">, </span><span class="S7">'FaceColor'</span><span class="S0">, [215 215 215]./255); geoshow(</span><span class="S7">'worldrivers.shp'</span><span class="S0">,</span><span class="S7">'Color'</span><span class="S0">, </span><span class="S7">'blue'</span><span class="S0">)</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    tmp(g.latlonmask) = gwmulti.Mu_est(:,i_t);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    surfm(g.lat2D,g.lon2D,tmp); caxis([-15 15])</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    i_tt=find(datenum(g.day(i_t))==data.day);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    scatterm(data.lat(~isnan(wmulti.Mus(i_tt,:))),data.lon(~isnan(wmulti.Mus(i_tt,:))),100,wmulti.Mus(i_tt,~isnan(wmulti.Mus(i_tt,:))),</span><span class="S7">'filled'</span><span class="S0">,</span><span class="S7">'MarkerEdgeColor'</span><span class="S0">,</span><span class="S7">'k'</span><span class="S0">)</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    title(datestr(g.day(i_t),</span><span class="S7">'dd-mmm'</span><span class="S0">))</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S10">end</span></span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><div class = "S9"><span class = "S2"><span class="S0">Export as gif</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% % filename='data/Density_estimationMap_M';</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% filename='data/Density_estimationMap_M';</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% Frame(g.nat) = struct('cdata',[],'colormap',[]); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% fig=figure(2); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% h=worldmap([min([g.lat]) max([g.lat])], [min([g.lon]) max([g.lon])]); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% setm(h,'frame','on','grid','off'); set(findall(h,'Tag','MLabel'),'visible','off'); set(findall(h,'Tag','PLabel'),'visible','off')</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% geoshow('landareas.shp', 'FaceColor', [215 215 215]./255); geoshow('worldrivers.shp','Color', 'blue')</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% set(gcf,'color','w'); hsurf=[];hscat=[];</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% caxis([-3 3]); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% tmp=nan(g.nlat, g.nlon);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% %caxis([0 80]);  c=colorbar;c.Label.String = 'Bird density [bird/km^2]';c.Label.FontSize=14;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% for i_t = 1:g.nat</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     delete(hsurf); delete(hscat)</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     tmp(g.latlonmask) = gmulti.M_est(:,i_t);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     hsurf=surfm(g.lat2D,g.lon2D,tmp);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     i_tt=find(datenum(g.day(i_t))==data.day);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     hscat=scatterm(data.lat(~isnan(multi.M_m(i_tt,:))),data.lon(~isnan(multi.M_m(i_tt,:))),100,multi.M_m(i_tt,~isnan(multi.M_m(i_tt,:))),'filled','MarkerEdgeColor','k');</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     title(datestr(g.day(i_t),'dd-mmm'),'FontSize',14); drawnow;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     Frame(i_t) = getframe(fig);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     [imind,cm] = rgb2ind(frame2im(Frame(i_t)),256); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     if i_t == 1</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%         imwrite(imind,cm,[filename '.gif'],'gif','Loopcount',inf);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     else</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%         imwrite(imind,cm,[filename '.gif'],'gif','WriteMode','append');</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     end</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% end</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0"></span></span></div></div></div><div class = "S13"><span class = "S2"><span class="S0"></span></span></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2"><span class="S0">5. Intra-night scale</span></span></h2><div class = "S9"><span class = "S2"><span class="S0">Covariance matrix of weather radar data </span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwintra.Ius_est = nan(g.nlm,g.nt);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwintra.Ius_sig = nan(g.nlm,g.nt);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwintra.Ivs_est = nan(g.nlm,g.nt);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwintra.Ivs_sig = nan(g.nlm,g.nt);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0"></span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">Ddist_rr_sm = squareform(pdist([data.lat data.lon], @lldistkm));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">Ddist_rg_sm = pdist2([data.lat data.lon], [g.lat2D(g.latlonmask) g.lon2D(g.latlonmask)], @lldistkm);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">tic</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S10">for </span><span class="S0">i_t=1:g.nat</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    disp([num2str(round(i_t/g.nat*100)) </span><span class="S7">'%  ' </span><span class="S0">num2str(toc/60) </span><span class="S7">'min'</span><span class="S0">])</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    i_b = g.day_b(i_t);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    id_r = wintra.day==datenum(g.day(i_t));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    id_g = g.day_id == i_t;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Dtime_rr = squareform(pdist(wintra.time(id_r)));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Ddist_rr = Ddist_rr_sm(wintra.radar(id_r),wintra.radar(id_r));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Dtime_rg = pdist2(wintra.time(id_r),datenum(g.time(id_g)));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Dtime_rg = Dtime_rg(:,repelem((1:sum(id_g))',g.nlm,1));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Ddist_rg = Ddist_rg_sm(wintra.radar(id_r),:);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Ddist_rg = repmat(Ddist_rg,1,sum(id_g));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    id = g.mask_day(:,id_g);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    id2 = false(size(gwintra.Ius_est));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    id2(:,id_g)=id;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span><span class="S11">% u</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Crr = wintra.cov.C_u(Ddist_rr,Dtime_rr,i_b);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Crg = wintra.cov.C_u(Ddist_rg(:,id(:)),Dtime_rg(:,id(:)),i_b);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Lambda = </span><span class="S0">inv</span><span class="S0">(Crr)*Crg;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0"></span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    gwintra.Ius_est(id2) = (Lambda' * wintra.Ius_n(id_r)) .* sqrt(wintra.f_trend(g.NNT(id2),wintra.beta_u(:,i_b)));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    gwintra.Ius_sig(id2) = sqrt( (sum(wintra.cov.parm_u(1:2,i_b)) - sum(Lambda.*Crg))  .* wintra.f_trend(g.NNT(id2)',wintra.beta_u(:,i_b)) ); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span><span class="S11">% v</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Crr = wintra.cov.C_v(Ddist_rr,Dtime_rr,i_b);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Crg = wintra.cov.C_v(Ddist_rg(:,id(:)),Dtime_rg(:,id(:)),i_b);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    Lambda = </span><span class="S0">inv</span><span class="S0">(Crr)*Crg;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0"></span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    gwintra.Ivs_est(id2) = (Lambda' * wintra.Ivs_n(id_r)) .* sqrt(wintra.f_trend(g.NNT(id2),wintra.beta_v(:,i_b)));</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    gwintra.Ivs_sig(id2) = sqrt( (sum(wintra.cov.parm_v(1:2,i_b)) - sum(Lambda.*Crg))  .* wintra.f_trend(g.NNT(id2)',wintra.beta_v(:,i_b)) ); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">        </span></span></div></div><div class = 'inlineWrapper outputs'><div class = "S5 lineNode"><span class = "S6"><span class="S10">end</span></span></div><div class="outputParagraph" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 14px;"><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement scrollableOutput" uid="EA4B443E" data-testid="output_0" data-width="1098" data-height="4511" style="width: 1128px; max-height: 261px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="textElement" style="white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">0%  0.00013918min<br>1%  1.5145min<br>1%  2.3739min<br>1%  3.3387min<br>2%  4.8194min<br>2%  6.5127min<br>2%  8.4169min<br>2%  9.1759min<br>3%  10.674min<br>3%  13.1506min<br>3%  15.6813min<br>4%  18.4139min<br>4%  20.9858min<br>4%  23.039min<br>5%  24.7418min<br>5%  25.8429min<br>5%  26.7937min<br>6%  27.8622min<br>6%  28.7464min<br>6%  29.6073min<br>7%  30.8018min<br>7%  32.0297min<br>7%  32.3887min<br>7%  33.4184min<br>8%  34.0683min<br>8%  34.1895min<br>8%  34.5728min<br>9%  35.1641min<br>9%  35.7749min<br>9%  36.9289min<br>10%  38.4809min<br>10%  39.4678min<br>10%  40.5167min<br>11%  40.8434min<br>11%  40.8616min<br>11%  41.7429min<br>11%  43.0303min<br>12%  44.4616min<br>12%  45.3996min<br>12%  46.8164min<br>13%  47.0586min<br>13%  47.8277min<br>13%  48.5011min<br>14%  49.0597min<br>14%  49.5648min<br>14%  50.7802min<br>15%  50.8159min<br>15%  50.8259min<br>15%  50.8352min<br>16%  50.8453min<br>16%  50.8547min<br>16%  51.0401min<br>16%  52.5663min<br>17%  53.9948min<br>17%  55.1736min<br>17%  56.2372min<br>18%  57.0581min<br>18%  58.066min<br>18%  59.2011min<br>19%  60.4364min<br>19%  61.3085min<br>19%  62.374min<br>20%  63.2963min<br>20%  64.6289min<br>20%  66.0137min<br>20%  67.2929min<br>21%  68.5526min<br>21%  69.8523min<br>21%  71.1439min<br>22%  72.1188min<br>22%  73.1449min<br>22%  74.01min<br>23%  74.8482min<br>23%  75.8072min<br>23%  76.6613min<br>24%  77.3493min<br>24%  77.7684min<br>24%  78.2958min<br>25%  79.2436min<br>25%  80.0103min<br>25%  80.0672min<br>25%  81.0382min<br>26%  82.0644min<br>26%  82.997min<br>26%  83.9452min<br>27%  84.7803min<br>27%  85.6296min<br>27%  86.4448min<br>28%  87.2551min<br>28%  87.8666min<br>28%  88.4068min<br>29%  89.0066min<br>29%  89.4831min<br>29%  90.055min<br>30%  90.0771min<br>30%  90.3816min<br>30%  90.6547min<br>30%  90.9292min<br>31%  91.1997min<br>31%  91.4448min<br>31%  92.141min<br>32%  92.8279min<br>32%  93.5469min<br>32%  94.2456min<br>33%  94.7935min<br>33%  95.3741min<br>33%  96.02min<br>34%  96.3196min<br>34%  96.6616min<br>34%  97.0373min<br>34%  97.4029min<br>35%  97.6044min<br>35%  97.8943min<br>35%  98.1205min<br>36%  98.3699min<br>36%  98.695min<br>36%  99.034min<br>37%  99.328min<br>37%  99.551min<br>37%  99.8234min<br>38%  100.0928min<br>38%  100.4432min<br>38%  100.7424min<br>39%  101.3421min<br>39%  101.9508min<br>39%  102.5329min<br>39%  103.1158min<br>40%  103.684min<br>40%  104.1856min<br>40%  104.7217min<br>41%  105.3289min<br>41%  105.8494min<br>41%  106.3832min<br>42%  106.9509min<br>42%  107.2753min<br>42%  107.2917min<br>43%  107.3018min<br>43%  107.3109min<br>43%  107.3206min<br>43%  107.3301min<br>44%  107.3402min<br>44%  107.3496min<br>44%  107.3593min<br>45%  107.3694min<br>45%  107.3793min<br>45%  107.389min<br>46%  107.3976min<br>46%  107.407min<br>46%  107.4164min<br>47%  107.4249min<br>47%  107.4345min<br>47%  107.4438min<br>48%  107.4535min<br>48%  107.4634min<br>48%  107.4722min<br>48%  107.48min<br>49%  107.4882min<br>49%  107.4978min<br>49%  107.5069min<br>50%  107.5152min<br>50%  107.5238min<br>50%  107.5332min<br>51%  107.5425min<br>51%  107.5515min<br>51%  107.5602min<br>52%  107.5698min<br>52%  107.5785min<br>52%  107.5876min<br>52%  107.5973min<br>53%  107.986min<br>53%  108.8264min<br>53%  109.7736min<br>54%  110.7274min<br>54%  111.6671min<br>54%  112.6377min<br>55%  113.6385min<br>55%  114.4396min<br>55%  115.352min<br>56%  116.2445min<br>56%  117.2688min<br>56%  118.3052min<br>57%  118.9673min<br>57%  119.8953min<br>57%  121.0271min<br>57%  122.1012min<br>58%  123.107min<br>58%  124.2783min<br>58%  125.4921min<br>59%  126.5652min<br>59%  127.8264min<br>59%  129.1026min<br>60%  130.4329min<br>60%  131.5448min<br>60%  132.4735min<br>61%  133.6973min<br>61%  134.4913min<br>61%  135.8707min<br>61%  137.0146min<br>62%  137.9002min<br>62%  139.1069min<br>62%  140.4837min<br>63%  141.8151min<br>63%  143.2386min<br>63%  144.5904min<br>64%  146.0866min<br>64%  147.3558min<br>64%  148.4857min<br>65%  150.0154min<br>65%  151.6416min<br>65%  153.4004min<br>66%  154.9427min<br>66%  156.384min<br>66%  157.8101min<br>66%  159.2198min<br>67%  160.0661min<br>67%  160.939min<br>67%  161.7906min<br>68%  162.593min<br>68%  163.4086min<br>68%  164.3015min<br>69%  166.1995min<br>69%  167.341min<br>69%  167.8896min<br>70%  168.9148min<br>70%  170.9748min<br>70%  172.7719min<br>70%  174.6633min<br>71%  176.6715min<br>71%  178.768min<br>71%  180.8021min<br>72%  182.4994min<br>72%  183.7186min<br>72%  185.1825min<br>73%  187.4034min<br>73%  189.5742min<br>73%  192.3152min<br>74%  193.5249min<br>74%  196.0891min<br>74%  198.7612min<br>75%  201.5054min<br>75%  203.6569min<br>75%  205.4059min<br>75%  207.6477min<br>76%  209.5224min<br>76%  210.963min<br>76%  213.2643min<br>77%  216.062min<br>77%  218.7085min<br>77%  221.434min<br>78%  224.3557min<br>78%  227.1367min<br>78%  229.9617min<br>79%  232.5969min<br>79%  234.0982min<br>79%  235.7449min<br>80%  238.5194min<br>80%  239.5222min<br>80%  241.5619min<br>80%  243.0153min<br>81%  244.1404min<br>81%  246.0487min<br>81%  247.9497min<br>82%  249.9251min<br>82%  252.9615min<br>82%  256.1092min<br>83%  259.6744min<br>83%  261.9783min<br>83%  264.2639min<br>84%  266.2488min<br>84%  267.9036min<br>84%  269.6745min<br>84%  270.396min<br>85%  272.0619min<br>85%  273.6593min<br>85%  277.019min<br>86%  280.3544min<br>86%  284.8073min<br>86%  288.4436min<br>87%  291.6996min<br>87%  293.8214min<br>87%  295.5704min<br>88%  297.581min<br>88%  300.4682min<br>88%  303.4857min<br>89%  305.15min<br>89%  306.9615min<br>89%  308.576min<br>89%  310.2259min<br>90%  311.85min<br>90%  313.5238min<br>90%  315.1812min<br>91%  317.2543min<br>91%  317.7252min<br>91%  317.9306min<br>92%  318.8375min<br>92%  321.8122min<br>92%  322.574min<br>93%  323.6267min<br>93%  324.2382min<br>93%  324.4192min<br>93%  325.4567min<br>94%  327.5433min<br>94%  329.8621min<br>94%  333.1436min<br>95%  336.0542min<br>95%  339.4475min<br>95%  341.0039min<br>96%  342.6765min<br>96%  345.4766min<br>96%  347.4195min<br>97%  348.3702min<br>97%  348.9548min<br>97%  349.6302min<br>98%  350.9278min<br>98%  351.9501min<br>98%  353.7195min<br>98%  359.2593min<br>99%  362.2509min<br>99%  365.194min<br>99%  367.6565min<br>100%  369.4195min<br>100%  369.6532min</div></div></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><div class = "S9"><span class = "S2"><span class="S0">Figure</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% filename='data/Density_estimationMap_I';</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">filename</span><span class="S0">=</span><span class="S7">'data/Density_estimationMap_In'</span><span class="S0">;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">Frame(g.nt) = struct(</span><span class="S7">'cdata'</span><span class="S0">,[],</span><span class="S7">'colormap'</span><span class="S0">,[]);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">fig</span><span class="S0">=figure;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">h=worldmap([min([g.lat]) max([g.lat])], [min([g.lon]) max([g.lon])]); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">setm(h,</span><span class="S7">'grid'</span><span class="S0">,</span><span class="S7">'off'</span><span class="S0">); set(findall(h,</span><span class="S7">'Tag'</span><span class="S0">,</span><span class="S7">'MLabel'</span><span class="S0">),</span><span class="S7">'visible'</span><span class="S0">,</span><span class="S7">'off'</span><span class="S0">); set(findall(h,</span><span class="S7">'Tag'</span><span class="S0">,</span><span class="S7">'PLabel'</span><span class="S0">),</span><span class="S7">'visible'</span><span class="S0">,</span><span class="S7">'off'</span><span class="S0">)</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">geoshow(</span><span class="S7">'landareas.shp'</span><span class="S0">, </span><span class="S7">'FaceColor'</span><span class="S0">, [215 215 215]./255); geoshow(</span><span class="S7">'worldrivers.shp'</span><span class="S0">,</span><span class="S7">'Color'</span><span class="S0">, </span><span class="S7">'blue'</span><span class="S0">)</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">set(gcf,</span><span class="S7">'color'</span><span class="S0">,</span><span class="S7">'w'</span><span class="S0">); hsurf=[];hscat=[];</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">caxis([-1 1]);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">tmp=nan(g.nlat, g.nlon);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S10">for </span><span class="S0">i_t = 1:g.nt</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    delete(hsurf); delete(hscat);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    tmp(g.latlonmask)=gwintra.I_est(:,i_t);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    hsurf=surfm(g.lat2D,g.lon2D,tmp);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0"></span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span><span class="S11">% id = abs(intra.time-datenum(g.time(i_t)))&lt;1/24/4;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span><span class="S11">% hscat=scatterm(data.lat(intra.radar(id)),data.lon(intra.radar(id)),[],intra.I_m(id),'filled','MarkerEdgeColor','k');</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    id = abs(data.time-g.time(i_t))&lt;1/24/4;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    hscat=scatterm(data.lat,data.lon,[],nanmean(wintra.I_m(id,:),1),</span><span class="S7">'filled'</span><span class="S0">,</span><span class="S7">'MarkerEdgeColor'</span><span class="S0">,</span><span class="S7">'k'</span><span class="S0">);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    title(datestr(g.time(i_t),</span><span class="S7">'dd-mmm HH:MM'</span><span class="S0">),</span><span class="S7">'FontSize'</span><span class="S0">,14); drawnow</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     Frame(i_t) = getframe(fig);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     [imind,cm] = rgb2ind(frame2im(Frame(i_t)),256); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     if i_t == 2</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%         imwrite(imind,cm,[filename '.gif'],'gif', 'DelayTime',0.1,'Loopcount',inf);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     else</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%         imwrite(imind,cm,[filename '.gif'],'gif', 'DelayTime',0.1,'WriteMode','append');</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     end</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S10">end</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% v=VideoWriter([filename '.avi']);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% v.FrameRate = 4;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% v.Quality = 75;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% open(v);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% writeVideo(v, Frame);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% close(v);</span></span></div></div></div><div class = "S13"><span class = "S2"><span class="S0"></span></span></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2"><span class="S0">6 Reassemble</span></span></h2><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwuv.u_est = gwmulti.Mu_est(:,g.day_id) + gwintra.Ius_est;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwuv.v_est = gwmulti.Mv_est(:,g.day_id) + gwintra.Ivs_est;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwuv.u_sig = sqrt(gwmulti.Mu_sig(:,g.day_id).^2 + gwintra.Ius_sig.^2);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">gwuv.v_sig = sqrt(gwmulti.Mv_sig(:,g.day_id).^2 + gwintra.Ivs_sig.^2);</span></span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><div class = "S9"><span class = "S2"><span class="S0">Figure</span></span></div><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">fig=figure(2);  </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">filename=</span><span class="S7">'data/Flight_estimationMap'</span><span class="S0">;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">Frame(g.nt) = struct(</span><span class="S7">'cdata'</span><span class="S0">,[],</span><span class="S7">'colormap'</span><span class="S0">,[]);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">h=worldmap([min([g.lat]) max([g.lat])], [min([g.lon]) max([g.lon])]); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">setm(h,</span><span class="S7">'grid'</span><span class="S0">,</span><span class="S7">'off'</span><span class="S0">); set(findall(h,</span><span class="S7">'Tag'</span><span class="S0">,</span><span class="S7">'MLabel'</span><span class="S0">),</span><span class="S7">'visible'</span><span class="S0">,</span><span class="S7">'off'</span><span class="S0">); set(findall(h,</span><span class="S7">'Tag'</span><span class="S0">,</span><span class="S7">'PLabel'</span><span class="S0">),</span><span class="S7">'visible'</span><span class="S0">,</span><span class="S7">'off'</span><span class="S0">)</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">geoshow(</span><span class="S7">'landareas.shp'</span><span class="S0">, </span><span class="S7">'FaceColor'</span><span class="S0">, [215 215 215]./255); geoshow(</span><span class="S7">'worldrivers.shp'</span><span class="S0">,</span><span class="S7">'Color'</span><span class="S0">, </span><span class="S7">'blue'</span><span class="S0">)</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">set(gcf,</span><span class="S7">'color'</span><span class="S0">,</span><span class="S7">'w'</span><span class="S0">); hsurf=[];hscat=[];</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">caxis([-15 15]);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">tmp_u=nan(g.nlat, g.nlon); tmp_v=nan(g.nlat, g.nlon);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S10">for </span><span class="S0">i_t = 1:g.nt</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    delete(hsurf); delete(hscat);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    tmp_u(g.latlonmask)=gwuv.u_est(:,i_t);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    tmp_v(g.latlonmask)=gwuv.v_est(:,i_t);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    hsurf=quiverm(g.lat2D,g.lon2D,tmp_u,tmp_v);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0"></span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span><span class="S11">% id = abs(intra.time-datenum(g.time(i_t)))&lt;1/24/4;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span><span class="S11">% hscat=scatterm(data.lat(intra.radar(id)),data.lon(intra.radar(id)),[],intra.I_m(id),'filled','MarkerEdgeColor','k');</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     id = abs(data.time-g.time(i_t))&lt;1/24/4;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     hscat=scatterm(data.lat,data.lon,[],nanmean(data.us(id,:),1),'filled','MarkerEdgeColor','k');</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">    title(datestr(g.time(i_t),</span><span class="S7">'dd-mmm HH:MM'</span><span class="S0">),</span><span class="S7">'FontSize'</span><span class="S0">,14); drawnow</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     Frame(i_t) = getframe(fig);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     [imind,cm] = rgb2ind(frame2im(Frame(i_t)),256); </span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     if i_t == 2</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%         imwrite(imind,cm,[filename '.gif'],'gif', 'DelayTime',0.1,'Loopcount',inf);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     else</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%         imwrite(imind,cm,[filename '.gif'],'gif', 'DelayTime',0.1,'WriteMode','append');</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">%     end</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">keyboard</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S10">end</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% v=VideoWriter([filename '.avi']);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% v.FrameRate = 4;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% v.Quality = 75;</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% open(v);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% writeVideo(v, Frame);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% close(v);</span></span></div></div></div></div><div class = "S0"></div><div class = 'SectionBlock containment'><h2 class = "S8"><span class = "S2"><span class="S0">7. Save</span></span></h2><div class = 'CodeBlock contiguous'><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S0">save(</span><span class="S7">'data/Wind_estimationMap'</span><span class="S0">,</span><span class="S7">'gwuv'</span><span class="S0">,</span><span class="S7">'-v7.3'</span><span class="S0">);</span></span></div></div><div class = 'inlineWrapper'><div class = "S5 lineNode"><span class = "S6"><span class="S11">% load('data/Density_estimationMap')</span></span></div></div></div></div></div><br><!-- <br>##### SOURCE BEGIN #####<br>%% Map Estimation<br>%% 1. Load data<br><br>clear all; warning off<br>load('./data/Density_inference.mat','data');<br>load('./data/Density_estimationMap','g');<br>load('./data/Wind_inference.mat');<br>addpath('./functions/'); <br>load coastlines.mat<br>%% 4. Multi-night scale<br>% Covariance matrix of weather radars<br>%%<br>gwmulti.Mu_est = nan(g.nlm,g.nat);<br>gwmulti.Mu_sig = nan(g.nlm,g.nat);<br>gwmulti.Mv_est = nan(g.nlm,g.nat);<br>gwmulti.Mv_sig = nan(g.nlm,g.nat);<br><br>for i_b=1:numel(data.block.date)<br>    id = ~wmulti.isnan & wmulti.B==i_b;<br>    Dtime=squareform(pdist(wmulti.T(id)));<br>    Ddist_aa=squareform(pdist([data.lat(wmulti.R(id)) data.lon(wmulti.R(id))],@lldistkm));<br>    <br>    Ddist_ab = pdist2([data.lat data.lon], [g.lat2D(g.latlonmask) g.lon2D(g.latlonmask)], @lldistkm);<br>    Ddist_sf = Ddist_ab(wmulti.R(id), repmat((1:g.nlm)',sum(g.day_b==i_b),1));<br>    Dtime_sf = pdist2(wmulti.T(id), repelem(datenum(g.day(g.day_b==i_b)),g.nlm,1));<br>    <br>    % u<br>    Caa = wmulti.cov.C_u(Ddist_aa,Dtime,i_b);<br>    Cab = wmulti.cov.C_u(Ddist_sf,Dtime_sf,i_b);<br>    Lambda = inv(Caa)*Cab;<br>    gwmulti.Mu_est(:,g.day_b==i_b) = reshape((Lambda' * wmulti.Mus(id)) + wmulti.f_trend(repelem(datenum(g.day(g.day_b==i_b)),g.nlm,1), repmat(g.lat2D(g.latlonmask),sum(g.day_b==i_b),1), repmat(g.lon2D(g.latlonmask),sum(g.day_b==i_b),1), wmulti.beta_u(:,i_b)), g.nlm, sum(g.day_b==i_b));<br>    gwmulti.Mu_sig(:,g.day_b==i_b) = reshape( sqrt(sum(wmulti.cov.parm_u(1:2,i_b)) - sum(Lambda.*Cab)), g.nlm, sum(g.day_b==i_b));<br>    <br>    % v<br>    Caa = wmulti.cov.C_v(Ddist_aa,Dtime,i_b);<br>    Cab = wmulti.cov.C_v(Ddist_sf,Dtime_sf,i_b);<br>    Lambda = inv(Caa)*Cab;<br>    gwmulti.Mv_est(:,g.day_b==i_b) = reshape((Lambda' * wmulti.Mvs(id)) + wmulti.f_trend(repelem(datenum(g.day(g.day_b==i_b)),g.nlm,1), repmat(g.lat2D(g.latlonmask),sum(g.day_b==i_b),1), repmat(g.lon2D(g.latlonmask),sum(g.day_b==i_b),1), wmulti.beta_v(:,i_b)), g.nlm, sum(g.day_b==i_b));<br>    gwmulti.Mv_sig(:,g.day_b==i_b) = reshape( sqrt(sum(wmulti.cov.parm_v(1:2,i_b)) - sum(Lambda.*Cab)), g.nlm, sum(g.day_b==i_b));<br>        <br>end<br>%% <br>% Figure<br>%%<br>tmp=nan(g.nlat, g.nlon);<br>figure('position',[0 0 1000 600]); <br>i=1;<br>for i_t = 1:12:g.nat<br>    subplot(4,6,i); hold on; i=i+1;<br>    h=worldmap([min([g.lat]) max([g.lat])], [min([g.lon]) max([g.lon])]); <br>    setm(h,'frame','on','grid','off'); set(findall(h,'Tag','MLabel'),'visible','off'); set(findall(h,'Tag','PLabel'),'visible','off')<br>    geoshow('landareas.shp', 'FaceColor', [215 215 215]./255); geoshow('worldrivers.shp','Color', 'blue')<br>    tmp(g.latlonmask) = gwmulti.Mu_est(:,i_t);<br>    surfm(g.lat2D,g.lon2D,tmp); caxis([-15 15])<br>    i_tt=find(datenum(g.day(i_t))==data.day);<br>    scatterm(data.lat(~isnan(wmulti.Mus(i_tt,:))),data.lon(~isnan(wmulti.Mus(i_tt,:))),100,wmulti.Mus(i_tt,~isnan(wmulti.Mus(i_tt,:))),'filled','MarkerEdgeColor','k')<br>    title(datestr(g.day(i_t),'dd-mmm'))<br>end<br>%% <br>% Export as gif<br>%%<br>% % filename='data/Density_estimationMap_M';<br>% filename='data/Density_estimationMap_M';<br>% Frame(g.nat) = struct('cdata',[],'colormap',[]); <br>% fig=figure(2); <br>% h=worldmap([min([g.lat]) max([g.lat])], [min([g.lon]) max([g.lon])]); <br>% setm(h,'frame','on','grid','off'); set(findall(h,'Tag','MLabel'),'visible','off'); set(findall(h,'Tag','PLabel'),'visible','off')<br>% geoshow('landareas.shp', 'FaceColor', [215 215 215]./255); geoshow('worldrivers.shp','Color', 'blue')<br>% set(gcf,'color','w'); hsurf=[];hscat=[];<br>% caxis([-3 3]); <br>% tmp=nan(g.nlat, g.nlon);<br>% %caxis([0 80]);  c=colorbar;c.Label.String = 'Bird density [bird/km^2]';c.Label.FontSize=14;<br>% for i_t = 1:g.nat<br>%     delete(hsurf); delete(hscat)<br>%     tmp(g.latlonmask) = gmulti.M_est(:,i_t);<br>%     hsurf=surfm(g.lat2D,g.lon2D,tmp);<br>%     i_tt=find(datenum(g.day(i_t))==data.day);<br>%     hscat=scatterm(data.lat(~isnan(multi.M_m(i_tt,:))),data.lon(~isnan(multi.M_m(i_tt,:))),100,multi.M_m(i_tt,~isnan(multi.M_m(i_tt,:))),'filled','MarkerEdgeColor','k');<br>%     <br>%     title(datestr(g.day(i_t),'dd-mmm'),'FontSize',14); drawnow;<br>%     Frame(i_t) = getframe(fig);<br>%     [imind,cm] = rgb2ind(frame2im(Frame(i_t)),256); <br>%     if i_t == 1<br>%         imwrite(imind,cm,[filename '.gif'],'gif','Loopcount',inf);<br>%     else<br>%         imwrite(imind,cm,[filename '.gif'],'gif','WriteMode','append');<br>%     end<br>% end<br><br>%% <br>% <br>%% 5. Intra-night scale<br>% Covariance matrix of weather radar data <br>%%<br>gwintra.Ius_est = nan(g.nlm,g.nt);<br>gwintra.Ius_sig = nan(g.nlm,g.nt);<br>gwintra.Ivs_est = nan(g.nlm,g.nt);<br>gwintra.Ivs_sig = nan(g.nlm,g.nt);<br><br>Ddist_rr_sm = squareform(pdist([data.lat data.lon], @lldistkm));<br>Ddist_rg_sm = pdist2([data.lat data.lon], [g.lat2D(g.latlonmask) g.lon2D(g.latlonmask)], @lldistkm);<br>tic<br>for i_t=1:g.nat<br>    disp([num2str(round(i_t/g.nat*100)) '%  ' num2str(toc/60) 'min'])<br>    i_b = g.day_b(i_t);<br>    id_r = wintra.day==datenum(g.day(i_t));<br>    id_g = g.day_id == i_t;<br>    <br>    Dtime_rr = squareform(pdist(wintra.time(id_r)));<br>    Ddist_rr = Ddist_rr_sm(wintra.radar(id_r),wintra.radar(id_r));<br>    <br>    Dtime_rg = pdist2(wintra.time(id_r),datenum(g.time(id_g)));<br>    Dtime_rg = Dtime_rg(:,repelem((1:sum(id_g))',g.nlm,1));<br>    Ddist_rg = Ddist_rg_sm(wintra.radar(id_r),:);<br>    Ddist_rg = repmat(Ddist_rg,1,sum(id_g));<br>    <br>    id = g.mask_day(:,id_g);<br>    id2 = false(size(gwintra.Ius_est));<br>    id2(:,id_g)=id;<br>    <br>    % u<br>    Crr = wintra.cov.C_u(Ddist_rr,Dtime_rr,i_b);<br>    Crg = wintra.cov.C_u(Ddist_rg(:,id(:)),Dtime_rg(:,id(:)),i_b);<br>    Lambda = inv(Crr)*Crg;<br><br>    gwintra.Ius_est(id2) = (Lambda' * wintra.Ius_n(id_r)) .* sqrt(wintra.f_trend(g.NNT(id2),wintra.beta_u(:,i_b)));<br>    gwintra.Ius_sig(id2) = sqrt( (sum(wintra.cov.parm_u(1:2,i_b)) - sum(Lambda.*Crg))  .* wintra.f_trend(g.NNT(id2)',wintra.beta_u(:,i_b)) ); <br>    <br>    % v<br>    Crr = wintra.cov.C_v(Ddist_rr,Dtime_rr,i_b);<br>    Crg = wintra.cov.C_v(Ddist_rg(:,id(:)),Dtime_rg(:,id(:)),i_b);<br>    Lambda = inv(Crr)*Crg;<br><br>    gwintra.Ivs_est(id2) = (Lambda' * wintra.Ivs_n(id_r)) .* sqrt(wintra.f_trend(g.NNT(id2),wintra.beta_v(:,i_b)));<br>    gwintra.Ivs_sig(id2) = sqrt( (sum(wintra.cov.parm_v(1:2,i_b)) - sum(Lambda.*Crg))  .* wintra.f_trend(g.NNT(id2)',wintra.beta_v(:,i_b)) ); <br>        <br>end<br>%% <br>% Figure<br>%%<br>% filename='data/Density_estimationMap_I';<br>filename='data/Density_estimationMap_In';<br>Frame(g.nt) = struct('cdata',[],'colormap',[]);<br>fig=figure;<br>h=worldmap([min([g.lat]) max([g.lat])], [min([g.lon]) max([g.lon])]); <br>setm(h,'grid','off'); set(findall(h,'Tag','MLabel'),'visible','off'); set(findall(h,'Tag','PLabel'),'visible','off')<br>geoshow('landareas.shp', 'FaceColor', [215 215 215]./255); geoshow('worldrivers.shp','Color', 'blue')<br>set(gcf,'color','w'); hsurf=[];hscat=[];<br>caxis([-1 1]);<br>tmp=nan(g.nlat, g.nlon);<br>for i_t = 1:g.nt<br>    delete(hsurf); delete(hscat);<br>    tmp(g.latlonmask)=gwintra.I_est(:,i_t);<br>    hsurf=surfm(g.lat2D,g.lon2D,tmp);<br><br>    % id = abs(intra.time-datenum(g.time(i_t)))<1/24/4;<br>    % hscat=scatterm(data.lat(intra.radar(id)),data.lon(intra.radar(id)),[],intra.I_m(id),'filled','MarkerEdgeColor','k');<br>    id = abs(data.time-g.time(i_t))<1/24/4;<br>    hscat=scatterm(data.lat,data.lon,[],nanmean(wintra.I_m(id,:),1),'filled','MarkerEdgeColor','k');<br>    <br>    title(datestr(g.time(i_t),'dd-mmm HH:MM'),'FontSize',14); drawnow<br>%     Frame(i_t) = getframe(fig);<br>%     [imind,cm] = rgb2ind(frame2im(Frame(i_t)),256); <br>%     if i_t == 2<br>%         imwrite(imind,cm,[filename '.gif'],'gif', 'DelayTime',0.1,'Loopcount',inf);<br>%     else<br>%         imwrite(imind,cm,[filename '.gif'],'gif', 'DelayTime',0.1,'WriteMode','append');<br>%     end<br>end<br>% v=VideoWriter([filename '.avi']);<br>% v.FrameRate = 4;<br>% v.Quality = 75;<br>% open(v);<br>% writeVideo(v, Frame);<br>% close(v);<br>%% <br>% <br>%% 6 Reassemble<br>%%<br>gwuv.u_est = gwmulti.Mu_est(:,g.day_id) + gwintra.Ius_est;<br>gwuv.v_est = gwmulti.Mv_est(:,g.day_id) + gwintra.Ivs_est;<br>gwuv.u_sig = sqrt(gwmulti.Mu_sig(:,g.day_id).^2 + gwintra.Ius_sig.^2);<br>gwuv.v_sig = sqrt(gwmulti.Mv_sig(:,g.day_id).^2 + gwintra.Ivs_sig.^2);<br>%% <br>% Figure<br>%%<br>fig=figure(2);  <br>filename='data/Flight_estimationMap';<br>Frame(g.nt) = struct('cdata',[],'colormap',[]);<br>h=worldmap([min([g.lat]) max([g.lat])], [min([g.lon]) max([g.lon])]); <br>setm(h,'grid','off'); set(findall(h,'Tag','MLabel'),'visible','off'); set(findall(h,'Tag','PLabel'),'visible','off')<br>geoshow('landareas.shp', 'FaceColor', [215 215 215]./255); geoshow('worldrivers.shp','Color', 'blue')<br>set(gcf,'color','w'); hsurf=[];hscat=[];<br>caxis([-15 15]);<br>tmp_u=nan(g.nlat, g.nlon); tmp_v=nan(g.nlat, g.nlon);<br>for i_t = 1:g.nt<br>    delete(hsurf); delete(hscat);<br>    tmp_u(g.latlonmask)=gwuv.u_est(:,i_t);<br>    tmp_v(g.latlonmask)=gwuv.v_est(:,i_t);<br>    hsurf=quiverm(g.lat2D,g.lon2D,tmp_u,tmp_v);<br><br>    % id = abs(intra.time-datenum(g.time(i_t)))<1/24/4;<br>    % hscat=scatterm(data.lat(intra.radar(id)),data.lon(intra.radar(id)),[],intra.I_m(id),'filled','MarkerEdgeColor','k');<br>%     id = abs(data.time-g.time(i_t))<1/24/4;<br>%     hscat=scatterm(data.lat,data.lon,[],nanmean(data.us(id,:),1),'filled','MarkerEdgeColor','k');<br>    <br>    title(datestr(g.time(i_t),'dd-mmm HH:MM'),'FontSize',14); drawnow<br>%     Frame(i_t) = getframe(fig);<br>%     [imind,cm] = rgb2ind(frame2im(Frame(i_t)),256); <br>%     if i_t == 2<br>%         imwrite(imind,cm,[filename '.gif'],'gif', 'DelayTime',0.1,'Loopcount',inf);<br>%     else<br>%         imwrite(imind,cm,[filename '.gif'],'gif', 'DelayTime',0.1,'WriteMode','append');<br>%     end<br>keyboard<br>end<br>% v=VideoWriter([filename '.avi']);<br>% v.FrameRate = 4;<br>% v.Quality = 75;<br>% open(v);<br>% writeVideo(v, Frame);<br>% close(v);<br>%% 7. Save<br>%%<br>save('data/Wind_estimationMap','gwuv','-v7.3');<br>% load('data/Density_estimationMap')<br>##### SOURCE END #####<br>--></body></html>